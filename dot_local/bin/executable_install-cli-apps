#!/usr/bin/env bash

noarch_install() {
    if ! [ -d $HOME/.asdf ]; then
        ASDF_REPO=https://github.com/asdf-vm/asdf.git
        git clone --no-checkout $ASDF_REPO $HOME/.asdf
        cd $HOME/.asdf
        git fetch --tags
        LATEST_TAG=$(git describe --tags `git rev-list --tags --max-count=1`)
        git checkout $LATEST_TAG
        cd $HOME

        source "$HOME/.asdf/asdf.sh"

        # Install some plugins
        asdf plugin add golang https://github.com/asdf-community/asdf-golang.git
        asdf plugin add nodejs https://github.com/asdf-vm/asdf-nodejs.git
        asdf plugin-add php https://github.com/asdf-community/asdf-php.git
        asdf plugin-add python https://github.com/asdf-community/asdf-python.git
        asdf plugin-add flutter https://github.com/asdf-community/asdf-flutter.git
    else
        source "$HOME/.asdf/asdf.sh"
    fi
}

macos_install() {
    if [[ ! -f /opt/homebrew/bin/brew ]]; then
        /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    fi
    eval "$(/opt/homebrew/bin/brew shellenv)"
}

linux_install() {
    if [[ ! -f /home/linuxbrew/.linuxbrew/bin/brew ]]; then
        /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
        sudo ln -s /home/linuxbrew/.linuxbrew/bin/brew /usr/local/bin/brew
    fi
    eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
}

brew_apps() {
    if ! which nvim > /dev/null; then
        brew install neovim
    fi

    if ! which lazygit > /dev/null; then
        brew install lazygit
    fi

    if ! which fzf > /dev/null; then
        brew install fzf
    fi

    if ! which fd > /dev/null; then
        brew install fd
    fi

    if ! which rg > /dev/null; then
        brew install ripgrep
    fi
}

noarch_install

if [[ $(uname) == "Darwin" ]]; then
    macos_install
else
    linux_install
fi

brew_apps
