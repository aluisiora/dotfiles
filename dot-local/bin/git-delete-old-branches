#!/usr/bin/env bash

if [[ ! -d .git ]]; then
    echo "Not in a git repository!"
    exit 1
fi

# Function to check if a branch exists
branch_exists() {
    git rev-parse --quiet --verify "$1" >/dev/null
}

current_branch=$(git symbolic-ref --short HEAD)
branches_to_ignore=("master" "develop" "$current_branch")

for branch in $(git for-each-ref --format='%(refname:short)' refs/heads); do
    if [[ ! " ${branches_to_ignore[@]} " =~ " $branch " ]]; then
        if branch_exists "$branch" && [ -z "$(git log -1 --before='30 days ago' -s $branch)" ]; then
            git branch -d $branch
        fi
    fi
done

